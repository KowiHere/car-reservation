<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Warsztat 4x4 – Rezerwacja</title>
    <style>
        /* --- Ogólne style strony (tło, font, kolory nagłówków) --- */
        body { font-family: Arial, sans-serif; margin: 40px; background: #1b1b1b; }
        h1, h2 { color: #77bfa3; }

        /* --- Flexbox: formularz i kalendarz obok siebie --- */
        .flexbox {
            display: flex;              /* Ustawia elementy w linii */
            align-items: flex-start;    /* Wyrównanie do góry */
            gap: 32px;                  /* Odstęp między formularzem i kalendarzem */
            margin-bottom: 40px;
        }

        /* --- Styl formularza --- */
        #rezerwacjaForm {
            background: #222;
            color: #fff;
            padding: 24px 22px;
            border-radius: 10px;
            box-shadow: 0 2px 8px #0003;
            flex: 0 0 400px;           /* Szerokość formularza */
            max-width: 420px;
            min-width: 320px;
        }
        label { display: block; margin: 12px 0 4px; font-size: 1.06em;}
        input, select, textarea {
            padding: 8px;
            width: 100%;
            border-radius: 6px;
            border: 1px solid #555;
            margin-bottom: 8px;
            background: #191919;
            color: #fff;
            font-size: 1.04em;
        }
        textarea { resize: vertical; }
        button {
            margin-top: 18px;
            padding: 10px 18px;
            border-radius: 6px;
            border: none;
            background: #214e34;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }
        .msg { margin: 12px 0; color: #197b30; font-weight: bold;}

        /* --- Styl kalendarza --- */
        #calendar {
            flex: 1;
            min-width: 650px;
            min-height: 700px;    /* Wysokość kalendarza (zmieniaj wedle uznania) */
            background: #222;
            color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px #0003;
            display: flex;
            flex-direction: column;
            justify-content: stretch;
        }

        /* --- Ciemny motyw dla FullCalendar (opcjonalnie) --- */
        .fc { background: #222; color: #fff; }
        .fc-toolbar-title { color: #77bfa3; }
        .fc-day-today { background: #2a4e3f !important; }
    </style>
    <!-- Ładowanie FullCalendar CSS i JS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
</head>
<body>
<h1>Rezerwacja wizyty w warsztacie</h1>

<!-- FLEXBOX: formularz po lewej, kalendarz po prawej -->
<div class="flexbox">

    <!-- FORMULARZ REZERWACJI -->
    <form id="rezerwacjaForm" autocomplete="off">
        <!-- Imię -->
        <label for="firstName">Imię:</label>
        <input type="text" id="firstName" required>
        <!-- Nazwisko -->
        <label for="lastName">Nazwisko:</label>
        <input type="text" id="lastName" required>
        <!-- Email -->
        <label for="email">Email:</label>
        <input type="email" id="email" required>
        <!-- Telefon -->
        <label for="phoneNumber">Telefon:</label>
        <input type="text" id="phoneNumber" required>
        <!-- Marka pojazdu -->
        <label for="carBrand">Marka pojazdu:</label>
        <input type="text" id="carBrand">
        <!-- Model pojazdu -->
        <label for="carModel">Model pojazdu:</label>
        <input type="text" id="carModel">
        <!-- Typ usługi -->
        <label for="serviceType">Typ usługi:</label>
        <select id="serviceType" required>
            <option value="">-- Wybierz --</option>
            <option value="PRZEGLAD">Przegląd</option>
            <option value="NAPRAWA">Naprawa</option>
            <option value="MODYFIKACJA">Modyfikacja</option>
            <option value="DIAGNOSTYKA">Diagnostyka</option>
            <option value="MONTAZ_AKCESORIOW">Montaż akcesoriów</option>
        </select>
        <!-- Data wizyty -->
        <label for="visitDate">Data wizyty:</label>
        <input type="date" id="visitDate" required>
        <!-- Godzina wizyty -->
        <label for="visitTime">Godzina wizyty:</label>
        <input type="time" id="visitTime" required>
        <!-- Notatka -->
        <label for="notes">Notatka (opcjonalnie):</label>
        <textarea id="notes" name="notes" rows="5"></textarea>
        <!-- Komunikaty -->
        <div class="msg" id="msg"></div>
        <!-- Przycisk wysyłki -->
        <button type="submit">Wyślij rezerwację</button>
    </form>

    <!-- KALENDARZ (FullCalendar) -->
    <div id="calendar"></div>
</div>

<script>
    // --- Obsługa wysłania formularza rezerwacji ---
    document.getElementById('rezerwacjaForm').onsubmit = async function (e) {
        e.preventDefault();
        const res = await fetch('/api/reservations', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                firstName: firstName.value,
                lastName: lastName.value,
                email: email.value,
                phoneNumber: phoneNumber.value,
                carBrand: carBrand.value,
                carModel: carModel.value,
                serviceType: serviceType.value,
                visitDate: visitDate.value,
                visitTime: visitTime.value,
                notes: notes.value
            })
        });
        if (res.ok) {
            document.getElementById('msg').textContent = "Rezerwacja wysłana!";
            document.getElementById('msg').classList.remove('error');
            rezerwacjaForm.reset();
            calendar.refetchEvents(); // Odśwież kalendarz po wysłaniu rezerwacji!
        } else {
            const error = await res.text();
            document.getElementById('msg').textContent = "Błąd: " + error;
            document.getElementById('msg').classList.add('error');
        }
    };

    // --- Inicjalizacja FullCalendar ---
    let calendar;
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',        // Widok tygodniowy z godzinami
            slotMinTime: "08:00:00",            // Początek dnia
            slotMaxTime: "17:00:00",            // Koniec dnia
            allDaySlot: false,
            locale: 'pl',                       // Polski język
            firstDay: 1,                        // Kalendarz zaczyna się od poniedziałku
            height: 'auto',                     // Automatyczna wysokość (wspomagana przez CSS)
            selectable: true,
            select: function(info) {
                // Po kliknięciu w kalendarzu uzupełnij formularz
                document.getElementById('visitDate').value = info.startStr.substring(0,10);
                document.getElementById('visitTime').value = info.startStr.substring(11,16);
            },
            events: '/api/reservations/calendar/fullcalendar' // Pobiera zajęte terminy z backendu
        });
        calendar.render();
    });
</script>
</body>
</html>
